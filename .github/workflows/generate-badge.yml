name: Update Profile PR Stats

# on:
#   schedule:
#     - cron: '0 6 * * 1' # 每周一早上 6 点更新
#   workflow_dispatch:
# 触发条件：在 push 到 main 分支后
on:
  push:
    branches:
      - main

jobs:
  update-profile:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Profile Repo
        uses: actions/checkout@v4
        with:
          repository: lxKylin/lxKylin
          token: ${{ secrets.DATA_CARD_TOKEN }}

      - name: Generate PR Statistics
        id: stats
        uses: lxKylin/repo-contribution-count-action@v1
        with:
          pr-links: |
            https://github.com/vitejs/docs-cn/commits?author=lxKylin
            https://github.com/vitest-dev/docs-cn/commits?author=lxKylin
            https://github.com/vitejs/docs-cn/pulls?q=is%3Apr+author%3AlxKylin
            https://github.com/element-plus/element-plus/commits?author=lxKylin
          github-token: ${{ secrets.DATA_CARD_TOKEN }}
          badge-style: 'for-the-badge'
          output-format: 'markdown'

      - name: Update Profile README
        run: |
          # 更新 README.md 中的 PR 统计部分
          sed -i '0,/<!-- PR_STATS_END -->/{/<!-- PR_STATS_START -->/,/<!-- PR_STATS_END -->/c\
<!-- PR_STATS_START -->\
## 🚀 我的开源贡献\
\
${{ steps.stats.outputs.badges }}\
\
> ${{ steps.stats.outputs.summary }}\
\
### Hi there 👋\
Welcome to my Github\
<hr>\
\
<a href="https://github.com/element-plus/element-plus/commits?author=lxKylin">\
<img align="center" src="https://raw.githubusercontent.com/lxKylin/lxKylin/svg/element-plus.svg" alt="" />\
</a>\
<a href="https://github.com/vitest-dev/docs-cn/commits?author=lxKylin">\
<img align="center" src="https://raw.githubusercontent.com/lxKylin/lxKylin/svg/docs-cn.svg" alt="" />\
</a>\
<a href="https://github.com/ant-design/ant-design/commits?author=lxKylin">\
<img align="center" src="https://raw.githubusercontent.com/lxKylin/lxKylin/svg/ant-design.svg" alt="" />\
</a>\
<a href="https://github.com/ant-design/ant-design-web3/commits?author=lxKylin">\
<img align="center" src="https://raw.githubusercontent.com/lxKylin/lxKylin/svg/ant-design-web3.svg" alt="" />\
</a>\
\
<table>\
  <tr>\
    <td><img align="center" src="https://github-readme-stats.vercel.app/api?username=lxKylin&show_icons=true&hide_border=true" alt="" /></td>\
    <td><img align="center" src="https://github-readme-stats.vercel.app/api/top-langs/?username=lxKylin&layout=compact&hide_border=true" alt="" /></td>\
  </tr>\
  <tr>\
    <td><img align="center" src="./image/juejin.svg" alt="" /></td>\
  </tr>\
</table>\
\
*最后更新: $(date "+%Y-%m-%d %H:%M:%S")*\
<!-- PR_STATS_END -->
}' README.md

      - name: Commit and Push
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add README.md
          git commit -m "📊 更新 PR 统计数据" || exit 0
          git push
